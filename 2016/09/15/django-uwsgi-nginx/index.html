<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A legendary army."><title>Deploy Django Project in nginx with uWSGI on Mac OS X | Crusade</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Deploy Django Project in nginx with uWSGI on Mac OS X</h1><a id="logo" href="/.">Crusade</a><p class="description">For honor!</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Deploy Django Project in nginx with uWSGI on Mac OS X</h1><div class="post-meta">Sep 15, 2016<span> | </span><span class="category"><a href="/categories/Back-End/">Back End</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/09/15/django-uwsgi-nginx/" href="/2016/09/15/django-uwsgi-nginx/#comments" class="ds-thread-count"></a><div class="post-content"><p>I have just (or maybe not yet) gone through the panic dealing with all the configuration of <a href="https://www.djangoproject.com/" target="_blank" rel="external">Django</a> framework on Mac OS X. This post details the steps to create a Django project and deploy it with <a href="https://uwsgi-docs.readthedocs.io/en/latest/" target="_blank" rel="external">uWSGI</a> in <a href="http://nginx.org/" target="_blank" rel="external">nginx</a>. Since the documentations and tutorials online mainly relate to Linux system, I hope this post will help you if you love Mac and want deploy Django apps on it.</p>
<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><ol>
<li>python 2.7 &amp; pip: <code>brew install python</code></li>
<li>nginx: <code>brew install nginx</code></li>
<li>virtualenv: <code>pip install virtualenv</code></li>
</ol>
<h2 id="What-is-nginx-and-uWSGI-and-why-should-I-use-them"><a href="#What-is-nginx-and-uWSGI-and-why-should-I-use-them" class="headerlink" title="What is nginx and uWSGI? and why should I use them?"></a>What is nginx and uWSGI? and why should I use them?</h2><p><a href="http://nginx.org/" target="_blank" rel="external">nginx</a> is a web server. A web server accepts the client’s request and send reponse to them. For static files such as images and static html pages, just put all the stuff in the web server is enough, but it’s not capable of sending dynamic pages. A web app serves client the content, e.g., it retrieves records from the database and organizes them into a html table. Django framework plays this kind of role. The web server needs a mechanism or protocal to talk to web app to get the content, and that’s what the <a href="https://wsgi.readthedocs.io/en/latest/" target="_blank" rel="external">WSGI</a> serves for. WSGI is short for Web Server Gateway Interface, which is a specification that describes how a web server communicates with web applications. <a href="https://uwsgi-docs.readthedocs.io/en/latest/" target="_blank" rel="external">uWSGI</a> is one of its implementations. Although Django itself contains a web server, it’s unsafe and doesn’t go through the performance tests. As Django puts it:</p>
<blockquote><p>We’re in the business of making Web frameworks, not Web servers, so improving this server to be able to handle a production environment is outside the scope of Django.</p>
<footer><strong>Django</strong><cite><a href="https://docs.djangoproject.com/en/1.10/ref/django-admin/#runserver" target="_blank" rel="external">django-admin documentation</a></cite></footer></blockquote>
<p>WSGI is an official python standard and lots of python web components are based on it. With WSGI, you can switch to any web server which supports it. nginx is much more lightweight than <a href="https://httpd.apache.org/" target="_blank" rel="external">Apache</a>, and has lots of 3rd party modules. Compared to Apache, it’s easy to configure and deploy. For other comparisons, please see <a href="https://www.digitalocean.com/community/tutorials/apache-vs-nginx-practical-considerations" target="_blank" rel="external">Apache vs Nginx: Practical Considerations</a>.</p>
<p>This post uses nginx as the web server, and uses uWSGI to communicate with nginx and Django.</p>
<h2 id="Start-the-project-and-install-all-the-dependencies"><a href="#Start-the-project-and-install-all-the-dependencies" class="headerlink" title="Start the project and install all the dependencies"></a>Start the project and install all the dependencies</h2><p>Here I use <a href="https://virtualenv.pypa.io/en/stable/" target="_blank" rel="external">virtualenv</a> to create isolated python environments. Here are the steps:</p>
<ol>
<li>Make a diretory named <code>mysite</code> and <code>cd</code> into it.</li>
<li>Create a virtual environment with virtualenv: <code>virtualenv venv</code>.</li>
<li>Activate the virtual environment: <code>source venv/bin/activate</code>.</li>
<li>Install <code>django</code> and <code>uwsgi</code>: <code>pip install django uwsgi</code>.</li>
<li>It’s better to use a <code>requirements.txt</code> file to log all the packages needed in the project: <code>pip freeze &gt; requirements.txt</code>. So next time you just need to run <code>pip install -r requirements.txt</code> to install all the dependencies at once. And if you are using git, you can put a <code>venv</code> item in <code>.gitignore</code> to prevent git tracking the unnecessary dependencies.</li>
</ol>
<h2 id="Start-a-Django-project-and-collect-the-static-and-media-files"><a href="#Start-a-Django-project-and-collect-the-static-and-media-files" class="headerlink" title="Start a Django project and collect the static and media files"></a>Start a Django project and collect the static and media files</h2><p>nginx needs to known where the static files (e.g., images, js scripts, etc.) locate, and we need configure to Django.</p>
<ol>
<li>Start a Django project: <code>django-admin.py startproject mysite</code></li>
<li><p><code>vim</code> or editor <code>mysite/settings.py</code>, add the following configurations:</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'static'</span>)</span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">   	os.path.join(BASE_DIR, <span class="string">"static1"</span>),</span><br><span class="line">   	os.path.join(BASE_DIR, <span class="string">"static2"</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">'media'</span>)</span><br><span class="line"></span><br><span class="line">MEDIA_URL = <span class="string">'/media/'</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure>
<p> <code>STATICFILES_DIRS</code> lists all the folders where Django will search for static files, and <code>STATIC_ROOT</code> points to the folder Django collects all the static files. The <code>media</code> folder is where Django saves the files the clients upload.</p>
</li>
<li>Set <code>DEBUG</code> as <code>False</code> since this post details the deployment procedure, and set  <code>ALLOWED_HOSTS = [&#39;127.0.0.1&#39;, &#39;localhost&#39;]</code>.</li>
<li>Create <code>static1</code>, <code>static2</code> and <code>media</code> folders and put some images into them to test whether we configure Django correctly. Here I put <code>left.jpg</code> into <code>static1</code>, <code>middle.jpg</code> into <code>static2</code>, and <code>right.jpg</code> into <code>media</code> folder.</li>
<li>When make changes to static files, make sure run <code>python manage.py collectstatic</code> to tell Django to copy all the static files into <code>static</code> folder, where nginx will search.</li>
<li>Run <code>python manage.py runserver</code> and you shall see all the images you just put into the static and media folders by visiting <a href="http://localhost:8000/static/left.jpg" target="_blank" rel="external">http://localhost:8000/static/left.jpg</a>, <a href="http://localhost:8000/static/middle.jpg" target="_blank" rel="external">http://localhost:8000/static/middle.jpg</a> and <a href="http://localhost:8000/media/right.jpg" target="_blank" rel="external">http://localhost:8000/media/right.jpg</a>.</li>
</ol>
<h2 id="Create-the-nginx-configuration-file-and-soft-link"><a href="#Create-the-nginx-configuration-file-and-soft-link" class="headerlink" title="Create the nginx configuration file and soft link."></a>Create the nginx configuration file and soft link.</h2><p>We need to tell nginx listen to which port, how to talk to Django and where to find the static files. Create a <code>mysite_nginx.conf</code> file in the folder where <code>manage.py</code> locates, with the following content:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># the upstream component nginx needs to connect to</span><br><span class="line">upstream mysite &#123;</span><br><span class="line">    # server 127.0.0.1:8001;</span><br><span class="line">    server unix:///tmp/mysite.sock; # for a file socket, more effective</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># configuration of the server</span><br><span class="line">server &#123;</span><br><span class="line">    # the port your site will be served on</span><br><span class="line">    listen      8888;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    charset     utf-8;</span><br><span class="line"></span><br><span class="line">    # max upload size</span><br><span class="line">    client_max_body_size 75M;   # adjust to taste</span><br><span class="line"></span><br><span class="line">    # Django media</span><br><span class="line">    location /media  &#123;</span><br><span class="line">        alias /path/to/your/media;  # your Django project&apos;s media files - amend as required</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /static &#123;</span><br><span class="line">        alias /path/to/your/static; # your Django project&apos;s static files - amend as required</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # Finally, send all non-media requests to the Django server.</span><br><span class="line">    location / &#123;</span><br><span class="line">        uWSGI_pass  mysite;</span><br><span class="line">        include	/path/to/your/uwsgi_params; # the uwsgi_params file you installed</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here we let nginx talk to Django through a unix file <code>/tmp/mysite.sock</code>, tell nginx listen to 8888 port, and instruct nginx to find the static and media files at where we have configured in the previous steps. nginx needs an <code>uwsgi_params</code> file, and you can find it at <a href="https://github.com/nginx/nginx/blob/master/conf/uwsgi_params" target="_blank" rel="external">https://github.com/nginx/nginx/blob/master/conf/uwsgi_params</a>.</p>
<p>We need to create a soft link to <code>mysite_nginx.conf</code> in <code>/usr/local/etc/nginx/servers</code> to make nginx find the configuration file and apply it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /path/to/your/mysite_nginx.conf /usr/local/etc/nginx/servers</span><br></pre></td></tr></table></figure>
<p>In <code>/usr/local/etc/nginx/nginx.conf</code>, there is a line: <code>include servers/*;</code>, so nginx knows to find and apply the configuration in the <code>servers</code> folder.</p>
<h2 id="Create-the-uWSGI-configuration-file"><a href="#Create-the-uWSGI-configuration-file" class="headerlink" title="Create the uWSGI configuration file"></a>Create the uWSGI configuration file</h2><p>Usually we put all the uWSGI configuration staff into a .ini file since there’re too many options if we use the command line args. Create a <code>mysite_uwsgi.ini</code>, and add the following into it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># mysite_uwsgi.ini file</span><br><span class="line">[uwsgi]</span><br><span class="line"></span><br><span class="line"># Django-related settings</span><br><span class="line"># the base directory (full path) where settings.py locates</span><br><span class="line">chdir           = /path/to/mysite/mysite</span><br><span class="line"># Django&apos;s wsgi file</span><br><span class="line">module          = mysite.wsgi</span><br><span class="line"># the virtualenv (full path)</span><br><span class="line">home            = /path/to/mysite/venv</span><br><span class="line"></span><br><span class="line"># process-related settings</span><br><span class="line"># master</span><br><span class="line">master          = true</span><br><span class="line"># maximum number of worker processes</span><br><span class="line">processes       = 10</span><br><span class="line"># the socket (use the full path to be safe)</span><br><span class="line">socket          = /tmp/mysite.sock</span><br><span class="line"># ... with appropriate permissions - may be needed</span><br><span class="line">chmod-socket    = 664</span><br><span class="line"># clear environment on exit</span><br><span class="line">vacuum          = true</span><br><span class="line"></span><br><span class="line"># create a pidfile</span><br><span class="line">pidfile = /tmp/mysite.pid</span><br><span class="line"># background the process &amp; log</span><br><span class="line">daemonize = uwsgi.log</span><br></pre></td></tr></table></figure>
<p>Since we use <code>virtualenv</code>, we need to use <code>home</code> option to tell uWSGI where to find the dependent packages. Here we use <code>socket</code> to designate the unix file where uWSGI uses to talk to nginx. In the previous steps, I said nginx talks to Django, and that’s inaccurate. Actually, nginx talks to uWSGI and uWSGI talks to Django:</p>
<pre><code>the web client &lt;-&gt; the web server &lt;-&gt; the socket(unix file here) &lt;-&gt; uWSGI &lt;-&gt; Django
</code></pre><p>We use a <code>pidfile</code> option to tell uWSGI to write down its pid when it is lauched. And we can use <code>uwsgi --stop /tmp/mysite.pid</code> to stop it. We use <code>daemonize</code> option to background the process and log uWSGI’s output into uwsgi.log.</p>
<h2 id="Launch-nginx-and-uWSGI"><a href="#Launch-nginx-and-uWSGI" class="headerlink" title="Launch nginx and uWSGI"></a>Launch nginx and uWSGI</h2><p>All the configuration work is done! Now we need to lauch nginx and uWSGI to check whether it works:</p>
<ol>
<li>Run <code>nginx</code> to lauch nginx.</li>
<li>Run <code>uwsgi --ini /path/to/mysite_uwsgi.ini</code> to start uWSGI.</li>
<li>Visit <a href="http://localhost:8888/static/left.jpg" target="_blank" rel="external">http://localhost:8888/static/left.jpg</a> to check whether it works.</li>
</ol>
<h2 id="Create-deploy-lauch-and-stop-shell-scripts"><a href="#Create-deploy-lauch-and-stop-shell-scripts" class="headerlink" title="Create deploy, lauch and stop shell scripts"></a>Create <code>deploy</code>, <code>lauch</code> and <code>stop</code> shell scripts</h2><p>There are some flaws in the previous configuration files. All the paths are hard coded. We can use shell scripts to avoid that.</p>
<h3 id="Create-deploy-sh"><a href="#Create-deploy-sh" class="headerlink" title="Create deploy.sh"></a>Create <code>deploy.sh</code></h3><p>In the folder where <code>manage.py</code> locates, create a <code>deploy.sh</code> file with the following content:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line">ROOT_PATH=`pwd`</span><br><span class="line">NGINX_CONFIG_FILE=mysite_nginx.conf</span><br><span class="line">NGINX_SITES_CONFIG=/usr/local/etc/nginx/servers</span><br><span class="line">UWSGI_CONFIG_FILE=mysite_uwsgi.ini</span><br><span class="line"></span><br><span class="line">echo &quot;&quot;&quot;</span><br><span class="line"># the upstream component nginx needs to connect to</span><br><span class="line">upstream mysite &#123;</span><br><span class="line">    # server 127.0.0.1:8001;</span><br><span class="line">    server unix:///tmp/mysite.sock; # for a file socket, more effective</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># configuration of the server</span><br><span class="line">server &#123;</span><br><span class="line">    # the port your site will be served on</span><br><span class="line">    listen      8888;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    charset     utf-8;</span><br><span class="line"></span><br><span class="line">    # max upload size</span><br><span class="line">    client_max_body_size 75M;   # adjust to taste</span><br><span class="line"></span><br><span class="line">    # Django media</span><br><span class="line">    location /media  &#123;</span><br><span class="line">        alias $ROOT_PATH/media;  # your Django project&apos;s media files - amend as required</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /static &#123;</span><br><span class="line">        alias $ROOT_PATH/static; # your Django project&apos;s static files - amend as required</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # Finally, send all non-media requests to the Django server.</span><br><span class="line">    location / &#123;</span><br><span class="line">        uwsgi_pass  mysite;</span><br><span class="line">	    include	$ROOT_PATH/uwsgi_params; # the uwsgi_params file you installed</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot; &gt; $NGINX_CONFIG_FILE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;&quot;&quot;</span><br><span class="line"># mysite_uwsgi.ini file</span><br><span class="line">[uwsgi]</span><br><span class="line"></span><br><span class="line"># Django-related settings</span><br><span class="line"># the base directory (full path)</span><br><span class="line">chdir           = $ROOT_PATH</span><br><span class="line"># Django&apos;s wsgi file</span><br><span class="line">module          = mysite.wsgi</span><br><span class="line"># the virtualenv (full path)</span><br><span class="line">home            = $ROOT_PATH/../venv</span><br><span class="line"></span><br><span class="line"># process-related settings</span><br><span class="line"># master</span><br><span class="line">master          = true</span><br><span class="line"># maximum number of worker processes</span><br><span class="line">processes       = 10</span><br><span class="line"># the socket (use the full path to be safe)</span><br><span class="line">socket          = /tmp/mysite.sock</span><br><span class="line"># ... with appropriate permissions - may be needed</span><br><span class="line">chmod-socket    = 664</span><br><span class="line"># clear environment on exit</span><br><span class="line">vacuum          = true</span><br><span class="line"></span><br><span class="line"># create a pidfile</span><br><span class="line">pidfile = /tmp/mysite.pid</span><br><span class="line"># background the process &amp; log</span><br><span class="line">daemonize = uwsgi.log</span><br><span class="line">&quot;&quot;&quot; &gt; $UWSGI_CONFIG_FILE</span><br><span class="line"></span><br><span class="line">if [ ! -d &quot;$NGINX_SITES_CONFIG&quot; ]; then</span><br><span class="line">    mkdir -p &quot;$NGINX_SITES_CONFIG&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">ln -sf $ROOT_PATH/$NGINX_CONFIG_FILE $NGINX_SITES_CONFIG</span><br></pre></td></tr></table></figure>
<p>It just replace all the hard coded paths with <code>$ROOT_PATH</code>.</p>
<h3 id="Create-start-sh"><a href="#Create-start-sh" class="headerlink" title="Create start.sh"></a>Create <code>start.sh</code></h3><p>In the folder where <code>manage.py</code> locates, create a <code>start.sh</code> file with the following content:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line"># start nginx</span><br><span class="line">sudo nginx</span><br><span class="line"></span><br><span class="line"># start uwsgi</span><br><span class="line">uwsgi --ini mysite_uwsgi.ini</span><br></pre></td></tr></table></figure>
<p>Just lauch nginx and uWSGI, no big deal.</p>
<h3 id="Create-stop-sh"><a href="#Create-stop-sh" class="headerlink" title="Create stop.sh"></a>Create <code>stop.sh</code></h3><p>Still in the folder where <code>manage.py</code> locates, create a <code>stop.sh</code> file with the following content:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line"># shut down uwsgi</span><br><span class="line">uwsgi --stop /tmp/mysite.pid</span><br><span class="line"></span><br><span class="line"># gracefully stop nginx</span><br><span class="line">sudo nginx -s quit</span><br></pre></td></tr></table></figure>
<p><code>stop.sh</code> will stop uWSGI and nginx.</p>
<p>Now you can place your project anywhere you like, and run <code>./depoly.sh</code> to create the configuration files and deploy it to nginx, run <code>./start.sh</code> to start the service and run <code>./stop.sh</code> to stop the service.</p>
<h2 id="Some-notes"><a href="#Some-notes" class="headerlink" title="Some notes"></a>Some notes</h2><ol>
<li>Make sure nginx has the permissions to read the <code>static</code> folder and read and write the <code>media</code> folder. Modify <code>/usr/local/etc/nginx/nginx.conf</code> and change the <code>user</code> option properly, e.g <code>user sean staff</code>.</li>
<li>mysite server uses the 8888 port, you can change it in <code>deploy.sh</code> if it has already been taken.</li>
</ol>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This post details the steps to start a Django project from scratch, and deploy it to nginx. You can clone the sample project at <a href="https://github.com/Sean-Lan/mysite" target="_blank" rel="external">Sean-Lan/mysite</a>, any feedback is welcome!</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>[1] <a href="http://uwsgi-docs.readthedocs.io/en/latest/tutorials/django_and_nginx.html" target="_blank" rel="external">Setting up Django and your web server with uWSGI and nginx</a></p>
<p>[2] <a href="https://docs.djangoproject.com/en/1.10/howto/static-files/" target="_blank" rel="external">Managing static files (e.g. images, JavaScript, CSS)</a></p>
<p>[3] <a href="https://uwsgi-docs.readthedocs.io/en/latest/" target="_blank" rel="external">The uWSGI project</a></p>
<p>[4] <a href="http://cheng.logdown.com/posts/2015/01/27/deploy-django-nginx-gunicorn-on-mac-osx" target="_blank" rel="external">Deploy Django + nginx + gunicorn on Mac OSX (Part 1)</a></p>
<p>[5] <a href="http://cheng.logdown.com/posts/2015/01/29/deploy-django-nginx-gunicorn-on-mac-osx-part-2" target="_blank" rel="external">Deploy Django + nginx + gunicorn on Mac OSX (Part 2)</a></p>
<p>[6] <a href="http://stackoverflow.com/questions/19875789/django-gives-bad-request-400-when-debug-false" target="_blank" rel="external">Django gives Bad Request (400) when DEBUG = False</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.sean-lan.com/2016/09/15/django-uwsgi-nginx/" data-id="cit4mk9ki0004zdjerq2g70mn" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Python/">Python</a><a href="/tags/Django/">Django</a></div><div class="post-nav"><a href="/2016/09/12/jupyter-notebook-set-up/" class="next">Setting Up Jupyter Notebook with JavaScript, Python2 and Python3 Support</a></div><div data-thread-key="2016/09/15/django-uwsgi-nginx/" data-title="Deploy Django Project in nginx with uWSGI on Mac OS X" data-url="http://www.sean-lan.com/2016/09/15/django-uwsgi-nginx/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/09/15/django-uwsgi-nginx/" data-title="Deploy Django Project in nginx with uWSGI on Mac OS X" data-url="http://www.sean-lan.com/2016/09/15/django-uwsgi-nginx/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.sean-lan.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Back-End/">Back End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Front-End/">Front End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile-Application/">Mobile Application</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/15/django-uwsgi-nginx/">Deploy Django Project in nginx with uWSGI on Mac OS X</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/jupyter-notebook-set-up/">Setting Up Jupyter Notebook with JavaScript, Python2 and Python3 Support</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/29/ways-to-horizontal-and-vertical-center/">Ways to Horizontally and Vertically Center Child Elements in Parent</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/28/ways-to-vertical-center/">Ways to Vertically Center Child Elements in Parent</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/ways-to-horizontal-center/">Ways to Horizontally Center Child Elements in Parent</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/04/android-permissions/">Working with Android System Permissions</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/21/react-project-template-using-webpack/">React Template Project Using webpack</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/23/scroll-to-top/">滚到到页面顶端(Scroll To Top)的简单实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/19/css-specificity/">简述CSS优先级</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.shinexu.com/" title="Vesion" target="_blank">Vesion</a><ul></ul><a href="http://rationaldesign.studio/" title="Rational Design" target="_blank">Rational Design</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Crusade.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'stupidsean'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7a1d7b5bb01512fff50895f7b6558c95";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>