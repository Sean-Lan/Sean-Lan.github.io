<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A legendary army."><title>Customize Browser Back and Forward Button Behavior | Crusade</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Customize Browser Back and Forward Button Behavior</h1><a id="logo" href="/.">Crusade</a><p class="description">For honor!</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Customize Browser Back and Forward Button Behavior</h1><div class="post-meta">Sep 24, 2016<span> | </span><span class="category"><a href="/categories/Front-End/">Front End</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/09/24/customize-browser-back-and-forward-button-behaviour/" href="/2016/09/24/customize-browser-back-and-forward-button-behaviour/#comments" class="ds-thread-count"></a><div class="post-content"><p>Nowadays, lots of web applications are springing up. It’s common to make the browser back and forward button work as expected to improve the user experience. This post discusses some hash related topics and introduces serveral practical methods to manipulate the browser history.</p>
<h2 id="The-URL-hash-and-HashChangeEvent"><a href="#The-URL-hash-and-HashChangeEvent" class="headerlink" title="The URL hash and HashChangeEvent"></a>The URL <code>hash</code> and <code>HashChangeEvent</code></h2><h3 id="The-basics"><a href="#The-basics" class="headerlink" title="The basics"></a>The basics</h3><p>The URL’s hash part is what after the hash (i.e, <code>#</code>) mark of a URL. For example the hash part of <code>http://www.example.com/page#hash1</code> is <code>hash1</code>, and some likes to refer it as <strong>fragment identifier</strong>. Some points noteworthy about the hash part are listed as follow:</p>
<ol>
<li><code>#</code> works only on client side, and is not included in the HTTP request.</li>
<li>Typically <code>#</code> represents a location in a page, and it can be saved into the browser bookmarks.</li>
<li>Change <code>#</code> won’t trigger the browser to reload the page, it will raise a <code>HashChangeEvent</code> to the browser instead.</li>
<li>Every time you change the <code>#</code> part, it will add a record into the browser history.</li>
</ol>
<p>You can visit <a href="https://en.wikipedia.org/wiki/Fragment_identifier" target="_blank" rel="external">Fragment Identifier</a> for detailed information about hash.</p>
<p>Your can use <code>location.hash=&#39;anotherHash&#39;</code> to manually trigger the <code>hashchange</code> event. The dispatched <code>HashChangeEvent</code> has two fields: <code>newURL</code> and <code>oldURL</code>. <code>newURL</code> points to the new URL the window is navigating to and <code>oldURL</code> is the previous one.</p>
<h3 id="A-Vivid-Example"><a href="#A-Vivid-Example" class="headerlink" title="A Vivid Example"></a>A Vivid Example</h3><p>Navigate to <code>http://www.example.com/</code>, open the browser console and paste the following code to listen to the <code>HashChangeEvent</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'old:'</span>, event.oldURL);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'new:'</span>, event.newURL);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>It will output the old and new URL when the <code>HashChangeEvent</code> is fired. Manually trigger it by</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">location.hash = <span class="string">'section1'</span></div></pre></td></tr></table></figure>
<p>It will log:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">old: http://www.example.com/</div><div class="line">new: http://www.example.com/#hash1</div></pre></td></tr></table></figure>
<p>Now, raise <code>HashChangeEvent</code> again:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">location.hash = <span class="string">'section2'</span></div></pre></td></tr></table></figure>
<p>It will log:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">old: http://www.example.com/#hash1</div><div class="line">new: http://www.example.com/#hash2</div></pre></td></tr></table></figure>
<p>Click the back button of your browser, it will also raise a <code>HashChangeEvent</code>, and the output is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">old: http://www.example.com/#hash2</div><div class="line">new: http://www.example.com/#hash1</div></pre></td></tr></table></figure>
<p>Then click the forward button, the output will be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">old: http://www.example.com/#hash1</div><div class="line">new: http://www.example.com/#hash2</div></pre></td></tr></table></figure>
<p>That’s all <code>hash</code> and <code>HashChangeEvent</code> about. For some older browsers that don’t support the <code>HashChangeEvent</code>, you can use <code>setInteval()</code> to watch the URL change manually. Visit <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onhashchange" target="_blank" rel="external">onhashchange</a> to learn more.</p>
<h3 id="Use-Cases-of-HashChangeEvent"><a href="#Use-Cases-of-HashChangeEvent" class="headerlink" title="Use Cases of HashChangeEvent"></a>Use Cases of <code>HashChangeEvent</code></h3><p>A typical use case for capturing <code>HashChangeEvent</code> is sending AJAX request to the server, and for SEO concern, you can use <code>#!</code> to enable the crawlers to visit the right pages. For example, if Google visits <code>http://twitter.com/#!/username</code>, it will crawler <code>http://twitter.com/?_escaped_fragment_=/username</code> so that it can get contents dynamically.</p>
<p>Another usage of <code>HashChangeEvent</code> is to customize the back and forward behavior of the browser. For example, if a user clicks a button to hide a chat box, you can mark it by setting the hash as <code>chatBoxClosed</code>, and if the user clicks the back button, you can capture the <code>HashChangeEvent</code> to show the chat box, and if the user then clicks the forward button, you can capture the <code>HashChangeEvent</code> and find the new hash is <code>chatBoxClosed</code>, then hide the chat box.</p>
<p>More complicated work can be done with lots of third party libraries. <a href="https://github.com/mmikowski/urianchor" target="_blank" rel="external">uriAnchor</a> is one of them. It’s a jQuery plugin, and you can set a hash as follow:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$.uriAnchor.setAnchor(&#123;</div><div class="line">  <span class="attr">page</span>   : <span class="string">'profile'</span>,</div><div class="line">  <span class="attr">_page</span>  : &#123;</div><div class="line">    <span class="attr">uname</span>   : <span class="string">'wendy'</span>,</div><div class="line">    <span class="attr">online</span>  : <span class="string">'today'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The hash part will be <code>#!page=profile:uname,wendy|online,today</code>. You can also call <code>$.uriAnchor.makeAnchorMap()</code> to decode the hash part and return a map as:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">page</span>   : <span class="string">'profile'</span>,</div><div class="line">  <span class="attr">_page</span>  : &#123;</div><div class="line">    <span class="attr">uname</span>   : <span class="string">'wendy'</span>,</div><div class="line">    <span class="attr">online</span>  : <span class="string">'today'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>For more advanced usage, please read the <a href="https://github.com/mmikowski/urianchor" target="_blank" rel="external">doc</a> about uriAnchor.</p>
<h2 id="The-history-Object"><a href="#The-history-Object" class="headerlink" title="The history Object"></a>The <code>history</code> Object</h2><p>We can also manipulate the <strong>session</strong> history through the <a href="https://developer.mozilla.org/en-US/docs/Web/API/History" target="_blank" rel="external"><code>history</code></a> object. Different from browser global history, a session history records the pages visited in the tab or frame that the current page is loaded in.</p>
<h3 id="Navigating-between-History-Pages"><a href="#Navigating-between-History-Pages" class="headerlink" title="Navigating between History Pages"></a>Navigating between History Pages</h3><p>We can navigate between history pages through <code>history.back()</code> and <code>history.forward()</code>. We can also move to a certain page relative to the current one, e.g. <code>history.go(-1);</code> will move back one page and <code>history.go(2)</code> will move forward two pages. The <code>history.length</code> property tells the number of pages in the history stack.</p>
<h3 id="Adding-and-Changing-History-Entries"><a href="#Adding-and-Changing-History-Entries" class="headerlink" title="Adding and Changing History Entries"></a>Adding and Changing History Entries</h3><p>The <code>history.pushState()</code> and <code>history.replaceState()</code> make it possible to manipulate history entries and associate a state object with each entry. Suppose you are at <code>http://www.example.com/</code> now. You can add a history entry with a state by:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">history.pushState(&#123;<span class="attr">statePropery</span>: <span class="string">'statePropery1'</span>&#125;, <span class="string">"page1"</span>, <span class="string">"#section1"</span>);</div></pre></td></tr></table></figure>
<p>The first parameter is a state object, in which you can store any related information; the second parameter is <code>title</code>, you can use it to name the state; the third one is the new URL. After the above command, the URL will be <code>http://www.example.com/#section1</code>, and the <code>history.state</code> object is <code>{statePropery: &#39;statePropery1&#39;}</code>. You can also replace current history entry by:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">history.pushState(&#123;<span class="attr">statePropery</span>: <span class="string">'statePropery2'</span>&#125;, <span class="string">"page2"</span>, <span class="string">"#section2"</span>);</div></pre></td></tr></table></figure>
<p>And the URL will be <code>http://www.example.com/#section2</code>, and the <code>history.state</code> object is <code>{statePropery: &#39;statePropery2&#39;}</code>. You can even add a history entry without modifying the URL:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">history.pushState(&#123;<span class="attr">statePropery</span>: <span class="string">'statePropery3'</span>&#125;, <span class="string">"page2"</span>, <span class="string">""</span>);</div></pre></td></tr></table></figure>
<p>The current state will be <code>{statePropery: &#39;statePropery3&#39;}</code>.</p>
<p><strong>Some Notes</strong>:</p>
<ol>
<li>The URL parameter in <code>pushState</code> and <code>replaceState</code> must be under the same origin with the current page.</li>
<li><code>pushState</code> and <code>replaceState</code> will not load the page, they just change the URL, and modify the history stack.</li>
<li><code>pushState</code> and <code>replaceState</code> will not trigger <code>HashChangeEvent</code> or <code>PopStateEvent</code> (See below), event though only the hash part changes.</li>
</ol>
<h3 id="The-PopStateEvent"><a href="#The-PopStateEvent" class="headerlink" title="The PopStateEvent"></a>The <code>PopStateEvent</code></h3><p>Each time the user clicks the browser back or forward button, it will raise a <code>PopStateEvent</code>. If the destination history entry is added or changed with <code>pushState</code> and <code>replaceState</code>, you can obtain the copy of related state object with its <code>state</code> property. We can also manually raise this event by <code>history.back()</code>, <code>history.forward()</code> and <code>history.go()</code>.</p>
<h3 id="Browser-Support-Concern"><a href="#Browser-Support-Concern" class="headerlink" title="Browser Support Concern"></a>Browser Support Concern</h3><p>The <code>pushState</code>, <code>replaceState</code> and <code>window.onpopstate</code> methods are relatively newer, and only IE 10 supports them. But the good news is that you can achieve it with <a href="https://github.com/browserstate/history.js" target="_blank" rel="external">history.js</a>.</p>
<h2 id="A-Simple-Comparison"><a href="#A-Simple-Comparison" class="headerlink" title="A Simple Comparison"></a>A Simple Comparison</h2><ol>
<li>The <code>HashChangeEvent</code> only be raised if the hash part of URL changes, and you need to change the hash part to add a history entry. With the History API, i.e,  <code>pushState</code>, <code>replaceState</code> and <code>window.onpopstate</code>, you can edit the URL more flexibly. You can change the URL into any under same origin and even add a history entry without modifying the URL.</li>
<li>You need to encode and decode the data manually into and from the hash part with <code>HashChangeEvent</code>, while you can obtain the copy of related state object with the <code>state</code> property of <code>PopStateEvent</code>. Although you can move the encoding and decoding work to 3rd party libraries like <a href="https://github.com/mmikowski/urianchor" target="_blank" rel="external">uriAnchor</a>, the History API is still more intuitive.</li>
<li>For the sake of the browser support, nearly all modern browers (IE 8+) support <code>onhashchange</code>, while only IE 10+ support the History API and you need use <a href="https://github.com/browserstate/history.js" target="_blank" rel="external">history.js</a> to bridge the gap.</li>
</ol>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This post discusses some hash related topics and gives several ways to manipulate the browser history. Some comparisons are made to help you choose the right technique to achieve your purpose. Nowadays, lots of complex web applications spring up with HTML5 and the browser support, it’s very important make sure that the back and forward button behavior properly. Hope it will help if you want to improve the UX of your web app by managing the browser history.</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.sean-lan.com/2016/09/24/customize-browser-back-and-forward-button-behaviour/" data-id="ciwxrd5wo0005luunuzdpmg1v" class="article-share-link">分享到</a><div class="tags"><a href="/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a href="/2016/10/25/python-re-quick-guide/" class="pre">Quick Guide to Python re module</a><a href="/2016/09/15/django-uwsgi-nginx/" class="next">Deploy Django Project in nginx with uWSGI on Mac OS X</a></div><div data-thread-key="2016/09/24/customize-browser-back-and-forward-button-behaviour/" data-title="Customize Browser Back and Forward Button Behavior" data-url="http://www.sean-lan.com/2016/09/24/customize-browser-back-and-forward-button-behaviour/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/09/24/customize-browser-back-and-forward-button-behaviour/" data-title="Customize Browser Back and Forward Button Behavior" data-url="http://www.sean-lan.com/2016/09/24/customize-browser-back-and-forward-button-behaviour/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.sean-lan.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Back-End/">Back End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Front-End/">Front End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile-Application/">Mobile Application</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/set-up-proxy-in-terminal/">Setting Up HTTP Proxy in Terminal</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/25/javascript-closure/">Javascript Closure: Typical Usages and Gotchas</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/python-re-grammar/">Python re Grammar Guide</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/python-re-quick-guide/">Quick Guide to Python re module</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/24/customize-browser-back-and-forward-button-behaviour/">Customize Browser Back and Forward Button Behavior</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/15/django-uwsgi-nginx/">Deploy Django Project in nginx with uWSGI on Mac OS X</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/jupyter-notebook-set-up/">Setting Up Jupyter Notebook with JavaScript, Python2 and Python3 Support</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/29/ways-to-horizontal-and-vertical-center/">Ways to Horizontally and Vertically Center Child Elements in Parent</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/28/ways-to-vertical-center/">Ways to Vertically Center Child Elements in Parent</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/ways-to-horizontal-center/">Ways to Horizontally Center Child Elements in Parent</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.shinexu.com/" title="Vesion" target="_blank">Vesion</a><ul></ul><a href="http://rationaldesign.studio/" title="Rational Design" target="_blank">Rational Design</a><ul></ul><a href="http://buchi.la/" title="Matt" target="_blank">Matt</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Crusade.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'stupidsean'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7a1d7b5bb01512fff50895f7b6558c95";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>