<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A legendary army."><title>CSS Animation and the Usage with React | Crusade</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CSS Animation and the Usage with React</h1><a id="logo" href="/.">Crusade</a><p class="description">For honor!</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CSS Animation and the Usage with React</h1><div class="post-meta">Mar 20, 2017<span> | </span><span class="category"><a href="/categories/Frontend/">Frontend</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/03/20/react-animation/" href="/2017/03/20/react-animation/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>I have been busy with hacking React in the last week. React is declarative, which means that all you need to do is to define the state, implement the <code>render()</code> method, and React will make the component be what it shoud be. No DOM manipulation like find, insert, and delete. But there’s a problem if you want to make some animation when the component shows. When used with jQuery, you can add a CSS class to an element to change some style after the element shows. However, it’s hard to do so because React performs all the DOM operation and it’s better not to access the DOM node directly. Good news is that React does offer some hooks to help you implement transitions and animaitions, and this post will discuss them by examples.</p>
<p>We’ll first go through properties and common usages of CSS transition and animations, and then learn how to use then with React. After that, Some common mistakes will be discussed to help you better understand React.</p>
<p>Let’s take a look at CSS transition first.</p>
<h2 id="CSS-Transition"><a href="#CSS-Transition" class="headerlink" title="CSS Transition"></a>CSS Transition</h2><p>Before CSS 3 introduces transition, nearly all the animations are make with JavaScript. For example, you need to find the DOM node first, and modify the CSS properties then. Although some libraries like jQuery do offer some handy functions to help you, the performance is not as good as pure CSS animations and too many style related JavaScript code will make your project a mess. With CSS transition, you just specify the duration when some certain CSS properties have changed, and CSS enigine will make it happen smoothly.</p>
<h3 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h3><p>The following is an example to change the background color when the cursor hovers. We only need to specify the propery we want to the transition happen (here, <code>background-color</code>), the duration (here, <code>1s</code>) and the timing function (<code>ease-in-out</code>, discuss it later):</p>
<iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/b0qzzugk/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<h3 id="Transition-Properies"><a href="#Transition-Properies" class="headerlink" title="Transition Properies"></a>Transition Properies</h3><p>There are 4 properties related to a transition: <code>transition-property</code>, <code>transition-duration</code>, <code>transition-timing-function</code> and <code>transition-delay</code>. <code>transition-property</code> specifies which CSS property triggers a transition when it gets changed; <code>transition-duration</code> is the time the transition exists; <code>transition-timing-function</code> describes how fast the CSS propery varies during the transition; and <code>transition-delay</code> is the amount of time to wait between a change being requested to a property that is to be transitioned and the start of the transition effect. For <code>transition-timing-function</code>, you can use <code>cubic-bezier</code> function and <code>steps</code> to get fine-grained control the transition velocity. You may find <a href="http://cubic-bezier.com/" target="_blank" rel="external">cubic-bezier.com/</a> helpful to customize <code>cubic-bezier</code>.</p>
<p>Normally, you can put the four properties in a line:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* property name | duration */</span></div><div class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">background-color</span> 4<span class="selector-tag">s</span>;</div><div class="line"></div><div class="line"><span class="comment">/* property name | duration | delay */</span></div><div class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">background-color</span> 4<span class="selector-tag">s</span> 1<span class="selector-tag">s</span>;</div><div class="line"></div><div class="line"><span class="comment">/* property name | duration | timing function | delay */</span></div><div class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">background-color</span> 4<span class="selector-tag">s</span> <span class="selector-tag">ease-in-out</span> 1<span class="selector-tag">s</span>;</div></pre></td></tr></table></figure>
<p>You can specify different transition properties for different CSS properties with comma separated:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">height</span> 4<span class="selector-tag">s</span>, <span class="selector-tag">width</span> 1<span class="selector-tag">s</span> <span class="selector-tag">linear</span> 3<span class="selector-tag">s</span>, <span class="selector-tag">background-color</span> 2<span class="selector-tag">s</span> <span class="selector-tag">ease-in-out</span> 4<span class="selector-tag">s</span>;</div></pre></td></tr></table></figure>
<p>The above transition definition specify three separate transitions for <code>height</code>, <code>width</code> and <code>background-color</code>.</p>
<p>Also, you can set <code>transition-property</code> as <code>all</code> if you want the transition rule to be applied to all the CSS properties:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">all</span> 1<span class="selector-tag">s</span> <span class="selector-tag">ease-in-out</span>;</div></pre></td></tr></table></figure>
<p>You can simply remove all transition rules of the element by setting <code>transition</code> as <code>unset</code>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">unset</span>;</div></pre></td></tr></table></figure>
<p>Here is a feigned secrect envelope animation with <code>width</code>, <code>background-color</code> and <code>color</code>:</p>
<iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/9LLmL9s3/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<p>When the envelope get hovered, it will expand for 1 second, and after that, the envelope’s background color and font color will change in 2 seconds.</p>
<h2 id="CSS-Animation"><a href="#CSS-Animation" class="headerlink" title="CSS Animation"></a>CSS Animation</h2><p>Though CSS transition is handy in making animations, it still has the following contraints:</p>
<ol>
<li>You can only set the start and end state of a transition and have no control of the transition process</li>
<li>You cannot pause the transition once it starts</li>
<li>You cannot specify the rounds of the animation</li>
</ol>
<p>To some extend, CSS animation extends CSS transition by defining transition in frames.</p>
<h3 id="Basic-Usage-1"><a href="#Basic-Usage-1" class="headerlink" title="Basic Usage"></a>Basic Usage</h3><p>To use CSS animation, there are two steps:</p>
<ol>
<li>Define the animation keyframes</li>
<li>Use the keyframes</li>
</ol>
<p>The following trembling example demos the basic usage of CSS animation. It first defines the trembling keyframes, then use it in a <code>animation</code> CSS property:</p>
<iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/oehqbzcf/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<h3 id="Keyframe-Syntax"><a href="#Keyframe-Syntax" class="headerlink" title="Keyframe Syntax"></a>Keyframe Syntax</h3><p>Keyframes are defined with an <code>@keyframes</code> keyword with frame list block, each list item is the CSS properties that will <em>apply from that point</em>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> trembling &#123;</div><div class="line">  0% &#123;<span class="attribute">transform</span>:<span class="built_in">translateX</span>(0) <span class="built_in">rotate</span>(0deg); <span class="attribute">background-color</span>: <span class="number">#333</span>;&#125;</div><div class="line">  20% &#123;<span class="attribute">transform</span>:<span class="built_in">translateX</span>(-10px) <span class="built_in">rotate</span>(-2deg);&#125;</div><div class="line">  40% &#123;<span class="attribute">transform</span>:<span class="built_in">translateX</span>(10px) <span class="built_in">rotate</span>(2deg);&#125;</div><div class="line">  50% &#123;<span class="attribute">background-color</span>: <span class="number">#e22</span>;&#125;</div><div class="line">  60% &#123;<span class="attribute">transform</span>:<span class="built_in">translateX</span>(-10px) <span class="built_in">rotate</span>(-2deg); &#125;</div><div class="line">  80% &#123;<span class="attribute">transform</span>: <span class="built_in">translateX</span>(10px) <span class="built_in">rotate</span>(2deg);&#125;</div><div class="line">  100%&#123;<span class="attribute">transform</span>: <span class="built_in">translateY</span>(0) <span class="built_in">rotate</span>(0deg); <span class="attribute">background-color</span>: <span class="number">#333</span>;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>By <em>“apply from that point”</em>, I mean, the new CSS properties will override the previous and take effect from then on. For example, from the start (0%) to 50%, the <code>background-color</code> is <code>#333</code> and from 50% to the end (100%), the <code>background-color</code> is <code>#e33</code>.</p>
<h3 id="Animation-Properties"><a href="#Animation-Properties" class="headerlink" title="Animation Properties"></a>Animation Properties</h3><p>The following animation is a very comprehensive usage of <code>animation</code> CSS property:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* name | duration | timing-function | delay |</span></div><div class="line">iteration-count | direction | fill-mode | play-state */</div><div class="line"><span class="selector-tag">animation</span>: <span class="selector-tag">slidein</span> 3<span class="selector-tag">s</span> <span class="selector-tag">ease-in</span> 1<span class="selector-tag">s</span> 2 <span class="selector-tag">reverse</span> <span class="selector-tag">both</span> <span class="selector-tag">paused</span>;</div></pre></td></tr></table></figure>
<p>The animation CSS property is a shorthand property for animation-name, animation-duration, animation-timing-function, animation-delay, animation-iteration-count, animation-direction, animation-fill-mode and animation-play-state, and serveral of them are similiar with <code>transition</code>, so we’ll discuss some animation-specific properties.</p>
<ul>
<li><code>animation-iteratoin-count</code> specifies how many times an animation should play, whose valid value includes <code>infinite</code>, and number. When it’s <code>infinite</code>, the animation will repeat forever; when it’s number, it’ll repeat exact the number times, and you can even pass a float value to it to make it only play part of an animation (e.g, 0.5 will play half of the animation cycle). The following spring animation plays 4 times, i.e, two up-down rounds (you may click <em>Edit in JSFiddle</em> or refresh the page to re-run the animation because it only runs once here).</li>
</ul>
<iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/Lrp8ugqL/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<ul>
<li><p><code>animation-direction</code> indicates the direction the animation should play, the default value is <code>normal</code>, which means the animation plays forward. You can use <code>reverse</code> to make it play in the reverse direction and use <code>alternate</code> or <code>alternate-reverse</code> to make the direction changes alternatively. The above spring example has <code>alternate-reverse</code> direction, and it first play backward, then forward, then backward, and finally forward.</p>
</li>
<li><p><code>animation-fill-mode</code> specifies how a CSS animation should apply styles to its target before and after it is executing. It has four valid values:</p>
<ul>
<li><code>none</code>: The animation will not apply any styles to the target when it’s not executing; it will instead be displayed using its state based on all other CSS rules applied to it.</li>
<li><code>forwards</code>: The target will retain the computed css value by the last keyframe when the animation ends. Here, the last keyframe is decided by <code>animation-iteration-count</code> dn <code>animation-direction</code>.</li>
<li><code>backwards</code>: The animation will apply the values defined in the first keyframe when the animation applies to the target, and this during the <code>animation-delay</code> period. The first keyframe depends on the value of <code>animation-direction</code>.</li>
<li><p><code>both</code>: The animation will follow the rules for both forwards and backwards, thus extending the animation properties in both directions.</p>
<p>The spring animation sets <code>animation-fill-mode</code> as <code>both</code>, you can see, in the 3-second delay time, the target div has green background and 1.2 times the height as defined in the 100% keyframe because its <code>animation-drection</code> is <code>alternate-reverse</code>, and after the animation ends, the target div still remains the computed values defined in the last keyframe due to <code>animation-iteration-count</code> as 4 and <code>animation-directin</code> as <code>alternate-reverse</code>.</p>
</li>
</ul>
</li>
<li><p><code>animation-play-state</code> determines whether an animation is running or paused, with two valid values: <code>running</code> and <code>paused</code>. It can be queried to determine whether or not the animation is currently running. In addition, its value can be set to pause and resume playback of an animation:</p>
</li>
</ul>
<iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/xwmgooae/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<p>We add <code>animation-play-state: paused</code> when the trembling <code>div</code> get hovered so that it stops trembling and calms down.</p>
<h2 id="Animation-with-jQuery"><a href="#Animation-with-jQuery" class="headerlink" title="Animation with jQuery"></a>Animation with jQuery</h2><p>Now we have our keyframe-base animation defined, and it works well. However, there’s still one problem: the animation just runs once at the very beginning, and we want to control it. The basic idea is simple, every time we want to apply the animation, we just need to add the animation class to the div and remember to remove the class when it finishes:</p>
<iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/tvf7kk2t/embedded/result,html,css,js/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  $demoDiv = $(<span class="string">'.demo'</span>);</div><div class="line">  $(<span class="string">'#spring-btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> ($demoDiv.hasClass(<span class="string">'spring'</span>)) <span class="keyword">return</span>;</div><div class="line">        $demoDiv.addClass(<span class="string">'spring'</span>);</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     $demoDiv.removeClass(<span class="string">'spring'</span>);</div><div class="line">    &#125;, <span class="number">11000</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Since the animation has 3-second delay and 4 2-second rounds, we should remove the CSS class after 11 seconds.</p>
<h2 id="Animation-in-React"><a href="#Animation-in-React" class="headerlink" title="Animation in React"></a>Animation in React</h2><p>React isn’t in favor of manipulating DOM directly, but it offers <em>hooks</em> for helping you achieve the desired transition effort. The <a href="https://facebook.github.io/react/docs/animation.html#high-level-api-reactcsstransitiongroup" target="_blank" rel="external"><code>ReactCSSTransitionGroup</code></a> is widely used for creating transition and animation. It will add several useful CSS class to the DOM node when its child element is added or removed. Let’s see an carousel example to see how it works.</p>
<p><img src="carousel.gif" alt="Picture Carousel"></p>
<p>As the above gif shows, we want to slide in every new picture and at the same time slide out the old one. We wrap the <code>img</code> element into a <code>ReactCSSTransitionGroup</code> tag:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Carousel = <span class="function">(<span class="params">&#123;imageSrc&#125;</span>) =&gt;</span>(</div><div class="line">   <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">carousel-frame</span>'&#125;&gt;</span></span></div><div class="line">     <span class="tag">&lt;<span class="name">ReactCSSTransitionGroup</span></span></div><div class="line">       <span class="attr">transitionName</span>=<span class="string">"carousel"</span></div><div class="line">       <span class="attr">transitionEnterTimeout</span>=<span class="string">&#123;2000&#125;</span></div><div class="line">       <span class="attr">transitionLeaveTimeout</span>=<span class="string">&#123;2000&#125;</span>&gt;</div><div class="line">     <span class="tag">&lt;<span class="name">img</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">carousel-img</span>'&#125; <span class="attr">src</span>=<span class="string">&#123;imageSrc&#125;</span> <span class="attr">key</span>=<span class="string">&#123;imageSrc&#125;</span> <span class="attr">alt</span>=<span class="string">&#123;imageSrc&#125;/</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="name">ReactCSSTransitionGroup</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"> );</div></pre></td></tr></table></figure>
<p><img src="carousel-class.gif" alt="Add Hook Class"></p>
<p>Everytime, the <code>img</code>‘s <code>src</code> property changes, React will add <code>carousel-leave</code> class to the old <code>img</code> and in the next tick add <code>carousel-leave-active</code> to it. Thus, we can use these two hook classes to achieve the sliding out effect:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.carousel-leave</span> &#123;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.carousel-leave-active</span> &#123;</div><div class="line">    <span class="attribute">left</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>At the same time, React will add <code>carousel-enter</code> class to the new <code>img</code> and in the next tick add <code>carousel-enter-active</code> to it. Now we can achieve the sliding in effect:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.carousel-enter</span> &#123;</div><div class="line">    <span class="attribute">left</span>: -<span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.carousel-enter-active</span> &#123;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Also for the first picture coming along with <code>ReactCSSTransitionGroup</code>, if you want it has the sliding in effect, you can add <code>transitionAppear={true}</code> and <code>transitionAppearTimeout={2000}</code> to <code>ReactCSSTransitionGroup</code>. The first picture will have <code>carousel-appear</code> class when it appears and <code>carousel-appear-active</code> in the next tick.</p>
<p>Please note that the <code>transitionAppearTimeout</code>, <code>transitionEnterTimeout</code> and <code>transitionLeaveTimeout</code> should keep accordance with the <code>transition-duration</code> CSS property:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">.carousel-img &#123;</div><div class="line">    ...</div><div class="line">    transition: left 2s ease-in-out;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>React will remove the classes it adds or the elements for you after the timeout specified as the properties of <code>ReactCSSTransitionGroup</code> and won’t care about the transition duration defined in the CSS file, so it’s your job to make them match. Please checkout the <a href="https://github.com/Sean-Lan/react-carousel" target="_blank" rel="external">repository</a> to learn more.</p>
<p>With CSS animation, you may not need to use all these hook classes and you would prefer to use the <code>-enter</code> with appropriate keyframed animations, since CSS animation itself defines the whole transition process. With the previous example, the CSS animation version may like this:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> slidein &#123;</div><div class="line">    0% &#123;</div><div class="line">        <span class="attribute">left</span>: -<span class="number">100%</span>;</div><div class="line">    &#125;</div><div class="line">    100% &#123;</div><div class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">keyframes</span> slideout &#123;</div><div class="line">    0% &#123;</div><div class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    100% &#123;</div><div class="line">        <span class="attribute">left</span>: <span class="number">100%</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="selector-class">.carousel-appear</span> &#123;</div><div class="line">    <span class="attribute">animation</span>: slidein <span class="number">2s</span> ease-in-out both;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.carousel-enter</span> &#123;</div><div class="line">    <span class="attribute">animation</span>: slidein <span class="number">2s</span> ease-in-out both;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.carousel-leave</span> &#123;</div><div class="line">    <span class="attribute">animation</span>: slideout <span class="number">2s</span> ease-in-out both;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You can checkout <a href="https://github.com/Sean-Lan/react-carousel/tree/animation" target="_blank" rel="external">this branch</a> to see the difference.</p>
<h2 id="Gotchas"><a href="#Gotchas" class="headerlink" title="Gotchas"></a>Gotchas</h2><p>The previous carousel example shows the basic usage with only one element. Things get much more complicated when you want to animate a list of elements. Don’t worry, we’ll go through two common mistakes here to save you time. To demo the usage with a list of elements, here we’ll write a TODO list much like the following:</p>
<p><img src="./todolist.gif" alt="React TODO List"></p>
<h3 id="Animation-Group-Must-Be-Mounted-To-Work"><a href="#Animation-Group-Must-Be-Mounted-To-Work" class="headerlink" title="Animation Group Must Be Mounted To Work"></a>Animation Group Must Be Mounted To Work</h3><p>As the <a href="https://facebook.github.io/react/docs/animation.html#animation-group-must-be-mounted-to-work" target="_blank" rel="external">official doc</a> puts it, <code>ReactCSSTransitionGroup</code> must already be mounted in the DOM or the prop <code>transitionAppear</code> must be set to <code>true</code> to make it take effect. The following code snippet won’t work because it mounts <code>ReactCSSTransitionGroup</code> with the <code>li</code> item at the same time:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">  <span class="keyword">const</span> items = <span class="keyword">this</span>.state.items.map(<span class="function">(<span class="params">item, i</span>) =&gt;</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ReactCSSTransitionGroup</span></span></span></div><div class="line">      <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></div><div class="line">      <span class="attr">transitionName</span>=<span class="string">'item'</span></div><div class="line">      <span class="attr">transitionEnterTimeout</span>=<span class="string">&#123;1000&#125;</span></div><div class="line">      <span class="attr">transitionLeaveTimeout</span>=<span class="string">&#123;1000&#125;</span> &gt;</div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">onDoubleClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;this.handleRemove(item);&#125;&#125;&gt;</div><div class="line">        &#123;item.text&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ReactCSSTransitionGroup</span>&gt;</span></div><div class="line">  ));</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'todo-container'</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span></span></div><div class="line">        <span class="attr">className</span>=<span class="string">'todo-input'</span></div><div class="line">        <span class="attr">placeholder</span>=<span class="string">'please input a todo item.'</span></div><div class="line">        <span class="attr">ref</span>=<span class="string">&#123;(input)</span> =&gt; &#123;this.input = input;&#125;&#125;</div><div class="line">        onKeyPress=&#123;this.handleKeyPress&#125;/&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">'todo-desc'</span>&gt;</span>Press Enter key to add; double-click item to remove<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">'todo-list'</span>&gt;</span></div><div class="line">          &#123;items&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You can add <code>transitionAppear={true}</code> and add proper <code>transitionAppearTime</code> to make the addition animation to take effect, but it’s possible to make removal animation happen in this way because <code>ReactCSSTransitionGroup</code> is blown away at the same time with the <code>li</code> item.</p>
<p>Therefore, <strong>embed the items in <code>ReactCSSTransitionGroup</code></strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">  <span class="keyword">const</span> items = <span class="keyword">this</span>.state.items.map(<span class="function">(<span class="params">item, i</span>) =&gt;</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span> <span class="attr">onDoubleClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;this.handleRemove(item);&#125;&#125;&gt;</span></div><div class="line">      &#123;item.text&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  ));</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'todo-container'</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span></span></div><div class="line">        <span class="attr">className</span>=<span class="string">'todo-input'</span></div><div class="line">        <span class="attr">placeholder</span>=<span class="string">'please input a todo item.'</span></div><div class="line">        <span class="attr">ref</span>=<span class="string">&#123;(input)</span> =&gt; &#123;this.input = input;&#125;&#125;</div><div class="line">        onKeyPress=&#123;this.handleKeyPress&#125;/&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">'todo-desc'</span>&gt;</span>Press Enter key to add; double-click item to remove<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">'todo-list'</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ReactCSSTransitionGroup</span></span></div><div class="line">          <span class="attr">transitionName</span>=<span class="string">'item'</span></div><div class="line">          <span class="attr">transitionAppear</span>=<span class="string">&#123;true&#125;</span></div><div class="line">          <span class="attr">transitionAppearTimeout</span>=<span class="string">&#123;1000&#125;</span></div><div class="line">          <span class="attr">transitionEnterTimeout</span>=<span class="string">&#123;1000&#125;</span></div><div class="line">          <span class="attr">transitionLeaveTimeout</span>=<span class="string">&#123;1000&#125;</span> &gt;</div><div class="line">          &#123;items&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">ReactCSSTransitionGroup</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Make-key-Prop-Unique-and-DO-NOT-Reuse-key"><a href="#Make-key-Prop-Unique-and-DO-NOT-Reuse-key" class="headerlink" title="Make key Prop Unique and DO NOT Reuse key"></a>Make <code>key</code> Prop Unique and DO NOT Reuse <code>key</code></h3><p>Sorry but I’ve made a mistake in the above the example, and if you run the above code, you’ll find the animation is totally a mess: the addition animation always apply to the last item in the list:</p>
<p><img src="reuse_key.gif" alt="Reusing the key"></p>
<p>The reason is that we use the loop index <code>i</code> as the key and React DOM diff algorithm depends on the <code>key</code> to lower the complexity, and when we delete an item, React will find that only the element with the largest <code>key</code> is missing and add hook class to it. So, better use a global unique key to each element, like the <code>id</code> property of <code>item</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> items = <span class="keyword">this</span>.state.items.map(<span class="function">(<span class="params">item, i</span>) =&gt;</span> (</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">onDoubleClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;this.handleRemove(item);&#125;&#125;&gt;</span></div><div class="line">    &#123;item.text&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">));</div></pre></td></tr></table></figure>
<p>The codes are available at <a href="https://github.com/Sean-Lan/react-animation-demo" target="_blank" rel="external">my github</a>, any feedback is welcome.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This post first introduces the syntax and basic usages with CSS transition and animation. With transition, we only need to specify which property should have the transition effect and its duration. When the property changes, CSS engine will help use make it happen. With animation, we need to specify the style state at certain timestamps with <code>@keyframe</code> syntax, and the animation CSS property grammar is very similar to transition. To use transition and animation, we need to add certain property at right time (often we use CSS class) and React offers <code>ReactCSSTransitionGroup</code> to add hook classes at property time. All we need is to wrap the components in <code>ReactCSSTransitionGroup</code> and use animation in appropriate classes. For most of the cases, <code>ReactCSSTransitionGroup</code> is enough. Read more about <a href="https://facebook.github.io/react/docs/animation.html#low-level-api-reacttransitiongroup" target="_blank" rel="external">ReactTransitionGroup</a> if you want to more fine-grained customization.</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.sean-lan.com/2017/03/20/react-animation/" data-id="cjajtse88000wj5uo78ao8smh" class="article-share-link">分享到</a><div class="tags"><a href="/tags/CSS/">CSS</a><a href="/tags/React/">React</a></div><div class="post-nav"><a href="/2017/02/11/server-side-rendering/" class="pre">Server Side Rendering with Redux and React-Server</a><a href="/2017/08/15/fetch-meets-302/" class="next">What will happen when fetch meets a 302 status code?</a></div><div id="disqus_thread"><script>var disqus_shortname = 'uniquelanxiang';
var disqus_identifier = '2017/03/20/react-animation/';
var disqus_title = 'CSS Animation and the Usage with React';
var disqus_url = 'http://www.sean-lan.com/2017/03/20/react-animation/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//uniquelanxiang.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.sean-lan.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Backend/">Backend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Language/">Language</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile-Application/">Mobile Application</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Koa/" style="font-size: 15px;">Koa</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/29/python2-unicode/">Practical Encoding in Python2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/15/fetch-meets-302/">What will happen when fetch meets a 302 status code?</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/react-animation/">CSS Animation and the Usage with React</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/11/server-side-rendering/">Server Side Rendering with Redux and React-Server</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/set-up-proxy-in-terminal/">Setting Up HTTP Proxy in Terminal</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/25/javascript-closure/">Javascript Closure: Typical Usages and Gotchas</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/python-re-grammar/">Python re Grammar Guide</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/python-re-quick-guide/">Quick Guide to Python re module</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/24/customize-browser-back-and-forward-button-behaviour/">Customize Browser Back and Forward Button Behavior</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/16/django-uwsgi-nginx/">Deploy Django Project in nginx with uWSGI on Mac OS X</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//uniquelanxiang.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.shinexu.com/" title="Vesion" target="_blank">Vesion</a><ul></ul><a href="http://buchi.la/" title="Matt" target="_blank">Matt</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Crusade.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7a1d7b5bb01512fff50895f7b6558c95";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>